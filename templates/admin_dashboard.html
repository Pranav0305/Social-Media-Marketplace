{% extends "layout.html" %}
{% block title %}Admin Dashboard{% endblock %}

{% block content %}
<h2>Admin Dashboard</h2>

{% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        {% for category, message in messages %}
        <p class="{% if category == 'danger' %}text-danger{% else %}text-success{% endif %}">                {{ message }}
            </p>
        {% endfor %}
    {% endif %}
{% endwith %}

<a href="{{ url_for('admin.logout') }}" style="float: right; background-color: red; color: white; padding: 5px 10px; text-decoration: none;">Logout</a>

<table border="1" cellpadding="5">
    <tr>
        <th>Email</th>
        <th>Username</th>
        <th>Document</th>
        <th>Status</th>
        <th>Action</th>
    </tr>
    {% for user in users %}
    <tr id="user-row-{{ user._id }}">
        <td>{{ user.email }}</td>
        <td>{{ user.username }}</td>
        <td>
            {% if user.document and user.document != "" %}
                <!-- Updated link to use the admin route that retrieves the GridFS file -->
                <a href="{{ url_for('admin.view_document', document_id=user.document) }}" target="_blank">View Document</a>
            {% else %}
                <span style="color: red;">No Document</span>
            {% endif %}
        </td>
        <td id="status-{{ user._id }}">{{ user.status }}</td>
        <td id="action-{{ user._id }}">
            {% if user.status == 'pending' %}
                <button class="approve-btn" data-url="{{ url_for('admin.approve_user', user_id=user._id) }}" data-userid="{{ user._id }}">Approve</button>
                <button class="reject-btn" data-url="{{ url_for('admin.reject_user', user_id=user._id) }}" data-userid="{{ user._id }}" style="background-color: red; color: white;">Reject</button>
            {% else %}
                <strong>{{ user.status | capitalize }}</strong>
            {% endif %}
        </td>
    </tr>
    {% endfor %}
</table>
<script src="{{ url_for('static', filename='js/admin_dashboard.js') }}"></script>
{% endblock %}
